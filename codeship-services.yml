mongodb:
  image: mongo:4.2.0
  cached: true

app:
  build:
    dockerfile: Dockerfile.build
  links:
    - mongodb
  environment:
    - MONGODB_URL=mongodb://mongodb:27017
  volumes:
    - ./:/var/www
  cached: true

docker:
  image: docker:dind
  add_docker: true
  volumes_from:
    - app
  encrypted_env_file: dockercfg.encrypted
  environment:
    - IMAGE_NAME=francescorivola/tribeca-notifier

deploy:
  build:
    dockerfile: Dockerfile.deploy-ssh
    encrypted_args_file: private-ssh-key.encrypted
  environment:
    - IMAGE_NAME=francescorivola/tribeca-notifier
  volumes_from:
    - app
  cached: true